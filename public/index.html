<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LynchFM - –°–ª—É—à–∞—Ç–µ–ª–∏</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .container {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            background: #1a1a1a;
            border-radius: 10px;
            border: 1px solid #333;
        }
        h1 {
            color: #00a8ff;
            margin-bottom: 30px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 20px 0;
            font-weight: bold;
        }
        .offline {
            background: #ff4444;
            color: white;
        }
        .online {
            background: #44ff44;
            color: #000;
        }
        .broadcast {
            background: #ff4444;
            color: white;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        audio {
            width: 100%;
            margin: 20px 0;
        }
        #nowPlaying {
            margin-top: 20px;
            color: #888;
            min-height: 24px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéß LynchFM</h1>
        <div class="status offline" id="status">–û–§–§–õ–ê–ô–ù</div>
        <audio id="player" controls autoplay></audio>
        <div id="nowPlaying">–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —ç—Ñ–∏—Ä–∞...</div>
    </div>

    <script>
        const player = document.getElementById('player');
        const statusEl = document.getElementById('status');
        const nowPlayingEl = document.getElementById('nowPlaying');
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º wss:// –µ—Å–ª–∏ –Ω–∞ HTTPS, –∏–Ω–∞—á–µ ws://
        const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
        const wsUrl = protocol + window.location.host;
        
        const ws = new WebSocket(wsUrl);
        
        ws.onopen = () => {
            statusEl.textContent = '–û–ù–õ–ê–ô–ù';
            statusEl.className = 'status online';
            nowPlayingEl.textContent = '–ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É —ç—Ñ–∏—Ä–∞...';
            console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
        };
        
        ws.onmessage = (event) => {
            // –ï—Å–ª–∏ –ø—Ä–∏—à–µ–ª Blob (–∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ)
            if (event.data instanceof Blob) {
                const url = URL.createObjectURL(event.data);
                player.src = url;
                
                statusEl.textContent = '–í –≠–§–ò–†–ï';
                statusEl.className = 'status broadcast';
                nowPlayingEl.textContent = '–ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä';
            }
            // –ï—Å–ª–∏ –ø—Ä–∏—à–µ–ª —Ç–µ–∫—Å—Ç (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ)
            else if (typeof event.data === 'string') {
                try {
                    const data = JSON.parse(event.data);
                    if (data.type === 'track') {
                        nowPlayingEl.textContent = `${data.artist} - ${data.title}`;
                    }
                } catch(e) {
                    // –ü—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –µ—Å–ª–∏ –Ω–µ JSON
                }
            }
        };
        
        ws.onclose = () => {
            statusEl.textContent = '–û–§–§–õ–ê–ô–ù';
            statusEl.className = 'status offline';
            nowPlayingEl.textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ...';
            
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                location.reload();
            }, 5000);
        };
        
        ws.onerror = (error) => {
            console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
        };
    </script>
</body>
</html>
